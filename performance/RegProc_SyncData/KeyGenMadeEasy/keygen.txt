Generating a Root and Intermediate CA Pair with OpenSSL üîê
This document outlines the process of creating a root Certificate Authority (CA) and an intermediate (or subordinate) CA using the OpenSSL command-line tool. This is a fundamental step in building a Public Key Infrastructure (PKI) where the intermediate CA can be used to issue certificates for servers and clients, while the root CA is kept offline for security.

1. The Root CA: The Trust Anchor
First, we need to create the self-signed root CA certificate. This is the top of the trust chain.

Step 1: Create the Root CA Private Key
Bash

openssl genrsa -aes256 -out ca.key 2048
This command generates a new, strong 2048-bit RSA private key for the root CA. The key is encrypted with AES-256 for security and a passphrase is required to use it.

Step 2: Create the Root CA Certificate
Bash

openssl req -new -x509 -key ca.key -sha256 -days 3650 -out ca.crt
This command creates a self-signed root certificate using the private key we just generated. The -x509 option specifies a self-signed certificate, and -days 3650 sets the validity to 10 years.

2. The Intermediate CA: The Issuing Authority
Next, we create an intermediate CA that will be signed by our root CA. This is the CA that will be used to issue certificates for your services.

Step 1: Create the Intermediate CA Private Key
Bash

openssl genrsa -aes256 -out intermediate.key 2048
Just like with the root CA, we generate a new private key for the intermediate CA. This key will be used to sign the intermediate certificate.

Step 2: Create the Intermediate CA Certificate Signing Request (CSR)
Bash

openssl req -new -key intermediate.key -sha256 -out intermediate.csr
A CSR is a request to a CA (in this case, our root CA) to sign a certificate. The -new option indicates that we're creating a new request.

Step 3: Sign the Intermediate CA's CSR with the Root CA
Bash

openssl x509 -req -in intermediate.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out intermediate.crt -days 365 -sha256 -extfile <(printf "basicConstraints=critical,CA:TRUE")
This is the most critical step. We use the root CA's private key and certificate to sign the intermediate CA's CSR, thereby creating the intermediate certificate. The -CA and -CAkey options point to the root CA's certificate and key. The -extensions v3_ca option ensures that this new certificate has the appropriate CA extensions, allowing it to sign other certificates.

Step 4: Verify the Certificate Chain
Bash

openssl verify -CAfile ca.crt intermediate.crt
This command confirms that the intermediate certificate was correctly signed by the root CA, ensuring the trust chain is intact.